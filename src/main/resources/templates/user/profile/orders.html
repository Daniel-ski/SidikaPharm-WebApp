<!DOCTYPE html>
<html
        lang="en"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>User Profile</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/user-profile.css}">
    <link rel="stylesheet" th:href="@{/css/main-header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">

</head>
<body>

<!-- Main Header -->
<header th:replace="fragments/header :: main-header"></header>

<!-- Sub-header -->
<header th:replace="fragments/header :: sub-header"></header>

<!-- Categories Header -->
<nav th:replace="fragments/header :: category-header"></nav>


<div class="main-cont container mt-5">
    <!-- Greeting -->
    <h2 class="mb-4">Здравейте, <span id="user-name" th:text="${userProfileDTO.firstName} + ' ' + ${userProfileDTO.lastName}"></span></h2>

    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs" id="profileTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="profile-tab" th:href="@{/user-profile/management}" role="tab" aria-controls="profile" aria-selected="false">
                <i class="fas fa-user"></i> Управление на профила
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="favorites-tab" th:href="@{/user-profile/favoriteProducts}" role="tab" aria-controls="favorites" aria-selected="false">
                <i class="fas fa-heart"></i> Любими
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link active" id="orders-tab" th:href="@{/user-profile/orders}" role="tab" aria-controls="orders" aria-selected="true">
                <i class="fas fa-truck"></i> Поръчки
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="shipping-tab" th:href="@{/user-profile/shipping}" role="tab" aria-controls="shipping" aria-selected="false">
                <i class="fas fa-map-marker-alt"></i> Данни за доставка
            </a>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" id="email-tab" th:href="@{/user-profile/email-preferences}" role="tab" aria-controls="email1" aria-selected="false">
                <i class="fas fa-envelope"></i> Емайл предпочитания
            </a>
        </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="profileTabsContent">
        <!-- Profile Management -->

        <div class="container mt-4">
            <h3 class="mb-4">Поръчки</h3>

            <p th:if="${allOrders == null or #lists.isEmpty(allOrders)}">Все още нямате направени поръчки.</p>

            <table th:if="${allOrders != null and not #lists.isEmpty(allOrders)}" class="table table-striped">
                <thead class="table-white">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Номер на поръчка</th>
                    <th scope="col">Дата на създаване</th>
                    <th scope="col">Обща цена</th>
                    <th scope="col">Статус</th>
                    <th scope="col">Действие</th>
                </tr>
                </thead>
                <tbody>
                <!-- Пример за една поръчка -->
                <tr th:each="order, iterStat : ${allOrders}">
                    <th scope="row" th:text="${iterStat.count}">count</th>
                    <td th:text="${order.id}">id</td>
                    <td th:text="${#dates.format(order.createdOn,'dd/MM/yyyy')}">date</td>
                    <td th:text="${order.totalPrice + ' лв.'}">totalPrice</td>
                    <td>
                        <span class="badge"
                              th:classappend="${order.status.name() == 'COMPLETE'} ? 'bg-success'
                                                : (${order.status.name() == 'IN_PROGRESS'} ? 'bg-warning text-white'
                                                 : 'bg-danger')">
                        th:text="${order.status}">status</span></td>
                    <td>
                        <button class="tbl btn btn-primary btn-sm" data-bs-toggle="modal"
                               th:attr="data-bs-target='#orderModal' + ${order.id}">Преглед</button>
                    </td>
                </tr>
                <!-- Добави още поръчки тук -->
                </tbody>
            </table>
        </div>

        <!-- Modal за детайли на поръчка -->
        <th:block th:each="order : ${allOrders}">
        <div class="modal fade" th:id="'orderModal' + ${order.id}" tabindex="-1"
             aria-labelledby="orderModalLabel" aria-hidden="true">

            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="orderModalLabel">Поръчка номер:
                            <span class="order-num" th:text="${order.id}"> id </span></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Затвори"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div class="row">
                                <!-- Пример за продукт -->
                                <div class="col-md-6 mb-3 d-flex align-items-center"
                                th:each="product : ${order.products}">
                                    <img th:src="${product.picture.locatedOn}" alt="Продукт" class="me-3">
                                    <div>
                                        <h6 class="mb-1" th:text="${product.title}">Име на продукт</h6>
                                        <p class="mb-0">Количество:
                                            <span > quantity </span></p>
                                        <p class="mb-0" th:text="${product.price + ' лв.'}">Цена:<span> price </span></p>
                                    </div>
                                </div>


                                <!-- Повече продукти могат да се добавят тук -->
                            </div>
                        </div>
                        <hr>
                        <p><strong>Тип доставка:</strong> <span> Стандартна </span></p>
                        <p><strong>Обща стойност:</strong> <span class="total"> 150.00 лв. </span></p>
                    </div>
                    <div class="modal-footer">
                        <!--                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Затвори</button>-->
                    </div>
                </div>
            </div>
        </div>
        </th:block>




    </div>

</div>

<footer>



    <div class="footer-wrapper">

        <div class="footer">
            <!-- Left Section -->


            <!-- Right Section -->

            <div class="first-section">
                <h1>Аптека</h1>
                <ul class="links">
                    <li><a href="#">Общи условия</a></li>
                    <li><a href="#">За нас</a></li>
                    <li><a href="#">Условия за доставка</a></li>
                </ul>
                <!--        <div class="footer-bottom">-->
                <!--          <p>Всички права запазени</p>-->
                <!--        </div>-->
            </div>

            <div style="border-left: 1px solid #6a1b9a; height: 100px; margin: 0 5px -20px;"></div>

            <div class="right-section">
                <h1>Контакти</h1>
                <ul class="links">
                    <li><a href="#"><i class="fas fa-map-marker-alt"></i> Намери най-близката аптека</a></li>
                    <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
                    <li><a href="#"><i class="fas fa-envelope"></i> Email</a></li>
                </ul>
            </div>
        </div>

        <!-- Logo Section -->
        <div class="logo-container">
            <div class="logo">
                <img src="/images/company-logo2.png" alt="Company Logo">
            </div>
            <div class="logo1">
                <img src="/images/company-text-logo.png" alt="Company Name">
            </div>

        </div>
    </div>
</footer>

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</body>
</html>
